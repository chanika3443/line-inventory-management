<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#f5f5f7">
  <title>ระบบคลังวัสดุ</title>
  
  <!-- Performance Optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://static.line-scdn.net">
  <link rel="preconnect" href="https://static.line-scdn.net">
  
  <!-- Intercept page parameter BEFORE LIFF loads -->
  <script>
    (function() {
      // Check if we're on GitHub Pages
      var isGitHubPages = window.location.hostname.includes('github.io');
      
      // Get page parameter from URL immediately
      var urlParams = new URLSearchParams(window.location.search);
      var page = urlParams.get('page');
      
      // Also check hash
      var hash = window.location.hash.substring(1);
      
      var targetPage = page || hash;
      
      if (targetPage && !isGitHubPages) {
        // Only redirect if NOT on GitHub Pages
        var validPages = ['products', 'withdraw', 'receive', 'return', 'reports', 'dashboard', 'logs'];
        if (validPages.indexOf(targetPage) !== -1) {
          // Redirect immediately before LIFF loads
          var baseUrl = '<?= baseUrl ?>';
          window.location.replace(baseUrl + '?page=' + targetPage);
          // Stop page loading
          document.write('Redirecting to ' + targetPage + '...');
          throw new Error('Redirecting');
        }
      }
    })();
  </script>
  
  <?!= include('base'); ?>
  <style>
    .hero-section {
      padding: 40px 24px;
      text-align: center;
    }
    .hero-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--accent) 0%, #5856d6 100%);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      box-shadow: 0 8px 24px rgba(0,122,255,0.3);
    }
    .hero-icon svg {
      width: 40px;
      height: 40px;
      stroke: white;
      stroke-width: 1.5;
    }
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .menu-item {
      background: var(--bg-elevated);
      border-radius: var(--radius-lg);
      padding: 24px 16px;
      text-align: center;
      text-decoration: none;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .menu-item::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.6) 0%, transparent 50%);
      pointer-events: none;
    }
    .menu-item:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .menu-item:active {
      transform: scale(0.97);
      opacity: 0.8;
    }
    .menu-icon {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 14px;
      position: relative;
    }
    .menu-icon svg {
      width: 26px;
      height: 26px;
      stroke-width: 1.5;
      position: relative;
    }
    .menu-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
      position: relative;
    }
    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .quick-action {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 18px;
      background: var(--bg-elevated);
      border-radius: var(--radius-md);
      text-decoration: none;
      box-shadow: var(--shadow-xs);
      border: 1px solid var(--border);
      transition: all var(--transition-fast);
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .quick-action:hover {
      background: var(--bg-secondary);
      transform: translateX(4px);
    }
    .quick-action:active {
      transform: translateX(2px) scale(0.98);
      opacity: 0.8;
    }
    .quick-action-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .quick-action-icon svg {
      width: 22px;
      height: 22px;
      stroke-width: 1.5;
    }
    .quick-action-text {
      flex: 1;
    }
    .quick-action-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .quick-action-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    .quick-action-arrow {
      color: var(--text-tertiary);
    }
  </style>
</head>
<body>
  <div class="hero-section">
    <div class="hero-icon">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
        <line x1="12" y1="22.08" x2="12" y2="12"/>
      </svg>
    </div>
    <h1 style="font-size: 28px; font-weight: 700; letter-spacing: -0.02em;">คลังวัสดุ</h1>
    <p style="color: var(--text-secondary); margin-top: 8px; font-size: 15px;">จัดการสต็อกผู้ป่วยใน</p>
  </div>
  
  <div class="container" style="padding-top: 0;">
    <div class="menu-grid">
      <a href="https://liff.line.me/2008893142-t04JvNpe#withdraw" class="menu-item">
        <div class="menu-icon" style="background: var(--warning-light);">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--warning)">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </div>
        <div class="menu-label">เบิกวัสดุ</div>
      </a>
      <a href="https://liff.line.me/2008893142-t04JvNpe#return" class="menu-item">
        <div class="menu-icon" style="background: rgba(52,199,89,0.1);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#34c759">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
            <path d="M21 3v5h-5"/>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
            <path d="M3 21v-5h5"/>
          </svg>
        </div>
        <div class="menu-label">คืน</div>
      </a>
      <a href="https://liff.line.me/2008893142-t04JvNpe#receive" class="menu-item">
        <div class="menu-icon" style="background: var(--success-light);">
          <svg viewBox="0 0 24 24" fill="none" stroke="var(--success)">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </div>
        <div class="menu-label">รับเข้า</div>
      </a>
      <a href="https://liff.line.me/2008893142-t04JvNpe#logs" class="menu-item">
        <div class="menu-icon" style="background: rgba(90,200,250,0.1);">
          <svg viewBox="0 0 24 24" fill="none" stroke="#5ac8fa">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="menu-label">ประวัติ</div>
      </a>
    </div>
    
    <div class="card-title" style="margin-top: 8px;">เมนูด่วน</div>
    <div class="quick-actions">
      <a href="https://liff.line.me/2008893142-t04JvNpe#reports" class="quick-action">
        <div class="quick-action-icon" style="background: linear-gradient(135deg, #af52de 0%, #ff2d55 100%);">
          <svg viewBox="0 0 24 24" fill="none" stroke="white">
            <path d="M3 3v18h18"/>
            <path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>
          </svg>
        </div>
        <div class="quick-action-text">
          <div class="quick-action-title">รายงาน</div>
          <div class="quick-action-desc">ดูรายงานและสถิติ</div>
        </div>
        <svg class="quick-action-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-item active" onclick="navigateTo('https://liff.line.me/2008893142-t04JvNpe')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <span>หน้าแรก</span>
    </div>
    <div class="nav-item" onclick="navigateTo('https://liff.line.me/2008893142-t04JvNpe#withdraw')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
      <span>เบิก</span>
    </div>
    <div class="nav-item" onclick="navigateTo('https://liff.line.me/2008893142-t04JvNpe#receive')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span>รับเข้า</span>
    </div>
    <div class="nav-item" onclick="navigateTo('https://liff.line.me/2008893142-t04JvNpe#return')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
      <span>คืน</span>
    </div>
    <div class="nav-item" onclick="navigateTo('https://liff.line.me/2008893142-t04JvNpe#dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg>
      <span>อื่นๆ</span>
    </div>
  </nav>
  
  <script>
    // Smooth navigation with visual feedback
    document.querySelectorAll('.bottom-nav a, .menu-item, .quick-action').forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Visual feedback
        this.style.opacity = '0.6';
        var self = this;
        
        // Navigate after brief delay for visual feedback
        setTimeout(function() {
          self.style.opacity = '1';
          navigateTo(self.href);
        }, 150);
      });
    });
  </script>
  
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    // LIFF initialization (optional, for future use)
    var liffId = '<?= liffId ?>';
    if (liffId) {
      // Defer LIFF init to not block page rendering
      setTimeout(function() {
        liff.init({ liffId: liffId }).then(function() {
          console.log('LIFF initialized');
        }).catch(function(err) {
          console.error('LIFF error:', err);
        });
      }, 100);
    }
    
    // Prefetch other pages for instant navigation
    if ('IntersectionObserver' in window) {
      var prefetchLinks = [
        '<?= baseUrl ?>?page=products',
        '<?= baseUrl ?>?page=withdraw',
        '<?= baseUrl ?>?page=receive',
        '<?= baseUrl ?>?page=dashboard'
      ];
      
      // Prefetch on idle
      if ('requestIdleCallback' in window) {
        requestIdleCallback(function() {
          prefetchLinks.forEach(function(url) {
            var link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = url;
            document.head.appendChild(link);
          });
        });
      }
    }
  </script>
</body>
</html>
